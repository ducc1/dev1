<?
error_reporting(E_ALL);

ini_set("display_errors", 1);


$sh["rPath"]		= "..";
$board_id			= "contents";
$cate_title = "검색";
include_once($sh["rPath"]."/_common.php");
$referer			= prevpage();
$sh["title"]		= $sh["stie_title"]."-".$board_info[name]." 게시판";
$sh_title			= $board_info[name];
$table01			= BOARD_WRITE_TABLE.$board_id;
$table02			= BOARD_FILE_TABLE;
$updir				= DATA_PATH."board/".$board_id."/";
$thumb_dir			= DATA_PATH."board/".$board_id."/thumb/";
$thumb_url			= "../data/board/".$board_id."/thumb/";
$upUrl				= "../data/board/".$board_id;

include_once($sh["rPath"]."/_head.php");


$rowslimit		= 9;
$pagelimit		= 10;
if(!$this_page) $this_page = 1;

$start			= $rowslimit*($this_page-1);
$limit			= $rowslimit;

$sch_key = $_POST['sch_key'];
$sch_text	= $_POST['search_txt'];


				$where[] = "a.notice = '0'";
if($cate)		$where[] = "a.category = '$cate'";
if($sch_key){
		$where[] = "$sch_key LIKE '%$sch_text%'";
} else {
		$where[] = "subject LIKE '%$sch_text%' or content LIKE '%$sch_text%'";
}

if($where)		$swhere  = " WHERE ".implode(" AND ", $where);	

$sql			= "SELECT a.* FROM ".$table01." a $swhere ORDER BY a.num DESC, a.reply ASC";
//echo $sql;
$row			= $DB->dfetcharr($sql." LIMIT $start , $limit");
$tot			= $DB->rows_count($sql);
$idx			= $tot-$rowslimit*($this_page-1);
$linkpage		= page($tot,$rowslimit,$pagelimit);

if($this_page==1){ 
	$noticeSql		= "SELECT a.* FROM ".$table01." a WHERE a.notice='1'";
	$noticeRow		= $DB->dfetcharr($noticeSql);
	if($noticeRow){
		$row		= @array_merge($noticeRow, $row);
		$idx		= $idx + sizeof($noticeRow);
	}
}

?>

	<div class="locationwrap">
		<div class="location">
			<a href="/" class="icon_set icon_home">home</a> &gt;
			<span>검색결과</span>
		</div>
	</div><!--//locationwrap -->

	<!-- con_wrap -->
	<div class="con_wrap clearfix">
		<!-- container -->
		<div class="container" id="container">

		<!-- ============================ 내용시작 ============================ -->
			<div class="contents">

				<div class="srhBox">
			<form name="se_fo" action="/sub/search_list.html" method="POST">
					<fieldset>
					<legend>검색</legend>
						<select name="sch_key">
							<option value="0" >전체</option>
							<option value="subject" <? if ($sch_key=='subject') { ?>selected<? } ?>>제목</option>
							<option value="content" <? if ($sch_key=='content') { ?>selected<? } ?>>내용</option>
						</select>
				   <input type="text" name="search_txt" placeholder="검색어를 입력해주세요." class="search_back" title="검색어 입력" value="<?=$_POST['search_txt']?>" style="ime-mode:active">
						<input type="submit" class="btnBig" value="검색">
					</fieldset>
					</form>
				</div><!-- //srhBox -->

					<ul class="contents_list clearfix">

					<? if(!sizeof($row)) { ?>
					<li style="width:100%;text-align:center; padding-top:20px">검색된 글이 없습니다.</li>
					<? } ?>

<?
		$brcnt		= 1; 
		for($i=0;$i<sizeof($row);$i++){
			$rows					= $row[$i];
			$rows[idx]				= $idx;
			$bg						= 'bg'.($i%2);
			$regdate				= strtotime($rows[datetime]);
			$today_time				= strtotime(date("Y-m-d H:i:s", strtotime("- ".$board_info[new_icon]." hour"))); 

			$reply_padding			= ($rows[reply])							? "padding-left:".(strlen($rows[reply]) * 20). "px;" : "";	
			$reply_image			= ($rows[reply])							? "<img src='".$board_skin."/img/icon_reply.png'>" : "";	
			$options_image			= ($rows[options]=="secret")				? "<img src='".$board_skin."/img/icon_secret.gif'>" : "";	
			$file_image				= ($rows[file] >0)							? "<img src='".$board_skin."/img/icon_file.gif'>" : "";	
			$new_image				= ($today_time < $regdate)					? "<img src='".$board_skin."/img/icon_new.gif'>" : "";	
			$best_image				= ($rows[hit] > $board_info[best_icon])		? "<img src='".$board_skin."/img/icon_best.gif'>" : "";	
			$rows[comment]			= ($rows[comment] > 0)						? "(".$rows[comment].")" : "";			
			$rows[idx2]				= ($rows[notice] == 1)						? "공지" : "";			
			$rows[noticecss]		= ($rows[notice] == 1)						? "_notice" : "";
			
			$rows[subject]			= text_cut_kr($rows[subject], 14);
			$rows[content]			= text_cut_kr(strip_tags($rows[content]), 82);
			extract($rows);

			$row_file	= $DB->fetcharr("SELECT filename FROM ".$table02." WHERE board_id='".$board_id."' AND board_no='".$rows[no]."' ORDER BY file_sort ASC");
			if($row_file[filename]){
				$board_img	= "<img src='".$thumb_url."thumb".$row_file[filename]."?>' class='def'>";
			}else{
				$board_img	= "";
			}

			?>
						
						<li>
							<a href="../board/board_view.php?board_id=<?=$board_id?>&no=<?=$no?>&cate=<?=$rows[category]?>">
								<div class="thumb">
									<?=$board_img?>
									<div class="dark"><img src="../comn/img/icon_thumb.png"></div>
								</div>
								<h4 class="tit_con"><span><?=$rows[category]?></span><?=$rows[subject]?></h4>
								<p><?=$rows[content]?></p>
							</a>
						</li>
<? } ?>						
					</ul>

				<div class="paging">
				<?=$linkpage?>
					<!-- <a href="#" class="arrow first">처음</a>
					<a href="#" class="arrow prev">이전</a>
					<span>1</span>
					<a href="#">2</a>
					<a href="#">3</a>
					<a href="#">4</a>
					<a href="#">5</a>
					<a href="#">6</a>
					<a href="#">7</a>
					<a href="#">8</a>
					<a href="#">9</a>
					<a href="#">10</a>
					<a href="#" class="arrow next">다음</a>
					<a href="#" class="arrow last">마지막</a> -->
				</div>



			</div><!--// contents-->
		<!-- ============================ 내용종료 ============================ -->

		</div><!--// container -->
		<?
include_once("../_bottom.php");
?>